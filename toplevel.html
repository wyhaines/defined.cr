<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 1.3.2">
<meta name="crystal_docs.project_version" content="0.3.4">
<meta name="crystal_docs.project_name" content="defined">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="defined">
  <title>Top Level Namespace - defined 0.3.4</title>
  <script type="text/javascript">
    CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          defined
        </a>
      </h1>

      <span class="project-version">
        0.3.4
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" current" data-id="defined/toplevel" data-name="top level namespace">
      <a href="toplevel.html">Top Level Namespace</a>
      
    </li>
  
  <li class=" " data-id="defined/Defined" data-name="defined">
      <a href="Defined.html">Defined</a>
      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1 class="type-name">

  Top Level Namespace

</h1>


















  <h2>
    <a id="defined-in" class="anchor" href="#defined-in">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Defined in:
  </h2>
  











  <h2>
    <a id="macro-summary" class="anchor" href="#macro-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Macro Summary
  </h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#defined%3F%28const%29-macro" class="signature"><strong>defined?</strong>(const)</a>
        
          <div class="summary"><p>This macro accepts a consonant, or a string or symbol of the consonant name.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#if_defined%3F%28const%2C%26code%29-macro" class="signature"><strong>if_defined?</strong>(const, &code)</a>
        
          <div class="summary"><p>This macro accepts a constant, or a string or a symbol of a fully qualified constant name.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#if_disabled%3F%28env_var%2C%26block%29-macro" class="signature"><strong>if_disabled?</strong>(env_var, &block)</a>
        
          <div class="summary"><p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment is not set.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#if_enabled%3F%28env_var%2C%26block%29-macro" class="signature"><strong>if_enabled?</strong>(env_var, &block)</a>
        
          <div class="summary"><p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment variable is set.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro" class="signature"><strong>if_version?</strong>(const, comparison, value, &code)</a>
        
          <div class="summary"><p>This macro accepts a constant, or a string or a symbol of a fully qualified constant name.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unless_defined%3F%28const%2C%26code%29-macro" class="signature"><strong>unless_defined?</strong>(const, &code)</a>
        
          <div class="summary"><p>This macro accepts a constant, or a string or a symbol of a fully qualified constant name.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unless_disabled%3F%28env_var%2C%26block%29-macro" class="signature"><strong>unless_disabled?</strong>(env_var, &block)</a>
        
          <div class="summary"><p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment variable is set.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unless_enabled%3F%28env_var%2C%26block%29-macro" class="signature"><strong>unless_enabled?</strong>(env_var, &block)</a>
        
          <div class="summary"><p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment variable is not set.</p></div>
        
      </li>
    
      <li class="entry-summary">
        <a href="#unless_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro" class="signature"><strong>unless_version?</strong>(const, comparison, value, &code)</a>
        
          <div class="summary"><p>See the documentation for <code><a href="toplevel.html#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">#if_version?</a></code>.</p></div>
        
      </li>
    
  </ul>



<div class="methods-inherited">
  
</div>








  <h2>
    <a id="macro-detail" class="anchor" href="#macro-detail">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Macro Detail
  </h2>
  
    <div class="entry-detail" id="defined?(const)-macro">
      <div class="signature">
        
        macro <strong>defined?</strong>(const)

        <a class="method-permalink" href="#defined%3F%28const%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>This macro accepts a consonant, or a string or symbol of the consonant name.
It validates whether the constant is defined, starting at the top level. The value
of the constant will be returned if it is defined. If it is not defined, <code>false</code> is
returned.</p>
<pre><code class="language-crystal">has_db <span class="o">=</span> defined?(<span class="s">&quot;DB&quot;</span>)

puts <span class="s">&quot;Yes, DB was required.&quot;</span> <span class="k">if</span> has_db</code></pre>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="if_defined?(const,&amp;code)-macro">
      <div class="signature">
        
        macro <strong>if_defined?</strong>(const, &code)

        <a class="method-permalink" href="#if_defined%3F%28const%2C%26code%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>This macro accepts a constant, or a string or a symbol of a fully qualified constant name.
It validates whether the constant is defined, starting at the top level. If the
constant is defined, the code passed to the macro via a block will be instantiated.
This permits conditional code evaluation based on whether a constant is defined.</p>
<pre><code class="language-crystal">if_defined?(<span class="s">&quot;MyClass::FeatureFlag&quot;</span>) <span class="k">do</span>
  <span class="t">Log</span>.info { <span class="s">&quot;MyClass::FeatureFlag has been enabled&quot;</span> }
<span class="k">end</span></code></pre>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="if_disabled?(env_var,&amp;block)-macro">
      <div class="signature">
        
        macro <strong>if_disabled?</strong>(env_var, &block)

        <a class="method-permalink" href="#if_disabled%3F%28env_var%2C%26block%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment
is not set.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="if_enabled?(env_var,&amp;block)-macro">
      <div class="signature">
        
        macro <strong>if_enabled?</strong>(env_var, &block)

        <a class="method-permalink" href="#if_enabled%3F%28env_var%2C%26block%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment
variable is set.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="if_version?(const,comparison,value,&amp;code)-macro">
      <div class="signature">
        
        macro <strong>if_version?</strong>(const, comparison, value, &code)

        <a class="method-permalink" href="#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>This macro accepts a constant, or a string or a symbol of a fully qualified constant name.
This constant will be checked for a <code>VERSION</code> or a <code>Version</code> constant, or a
<code>#version</code> method under it. If it exists, the value held by that constant, or
returned by the <code>#version</code> method is compared with the provided comparison operator
to the value, using a SemanticVersion comparison.</p>
<pre><code class="language-crystal">if_version?(<span class="s">&quot;Crystal&quot;</span>, <span class="n">:&gt;</span>, <span class="s">&quot;1.0.0&quot;</span>) <span class="k">do</span>
  <span class="c"># Do a thing that only works on Crystal 1.0.0 and later</span>
<span class="k">end</span></code></pre>
<h4><a id="caveats" class="anchor" href="#caveats">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Caveats</h4>
<p>If the version is defined using a macro expression (macro code enclosed in a <code>{{ ... }}</code> block),
things become more difficult. The <code>compare_versions</code> macro expects to to receive a StringLiteral,
SymbolLiteral, or MacroID. If it receives a MacroExpression, it can not evaluate that expression
to access the value that it returns, and an exception is thrown when the macro is evaluated.
To make things more interesting, there is no way to force that MacroExpression to be expanded
from within macro code, making it difficult to access the value. So, for instance, if there were
the following version definition:</p>
<pre><code class="language-crystal"><span class="k">class</span> <span class="t">Foo</span>
  <span class="t">VERSION</span> <span class="o">=</span> {{ <span class="s">`shards version &quot;</span><span class="i">#{</span>__DIR__<span class="i">}</span><span class="s">&quot;`</span>.chomp.stringify }}
<span class="k">end</span></code></pre>
<p>Then the <code><a href="toplevel.html#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">if_version?</a></code> macro would not be able to access the value of <code>VERSION</code> because it
would be a MacroExpression.</p>
<p>This library does have a workaround for that situation, which will work for simple cases like the
above example, however. Essentially, when it encounters a MacroExpression, it reformulates the
constant into the local scope, with evaluation wrapped by a <code>{% begin %} ... {% end %}</code> block.
Wrapping the macro expression in that way ensures that the value of the expression is already
assigned to the constant when the <code><a href="toplevel.html#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">if_version?</a></code> macro is evaluated.
So, <code><a href="toplevel.html#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">if_version?</a></code> used on Foo, might look like this:</p>
<pre><code class="language-crystal">if_version?(<span class="s">&quot;Foo&quot;</span>, <span class="n">:&gt;</span>, <span class="s">&quot;1.0.0&quot;</span>) <span class="k">do</span>
  <span class="c"># Awesome. That&#39;s a great version of Foo!</span>
<span class="k">end</span></code></pre>
<p>The macro will rewrite that to look something like this:</p>
<pre><code class="language-crystal">{% <span class="k">begin</span> %}
<span class="t">X__temp_731</span> <span class="o">=</span> {{ <span class="s">`shards version &quot;</span><span class="i">#{</span>__DIR__<span class="i">}</span><span class="s">&quot;`</span>.chomp.stringify }}
{% <span class="k">end</span> %}
if_version?(<span class="s">&quot;Foo&quot;</span>, <span class="n">:&gt;</span>, <span class="s">&quot;1.0.0&quot;</span>) <span class="k">do</span>
  <span class="c"># Awesome. That&#39;s a great version of Foo!</span>
<span class="k">end</span></code></pre>
<p>And this <em>will</em> work.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="unless_defined?(const,&amp;code)-macro">
      <div class="signature">
        
        macro <strong>unless_defined?</strong>(const, &code)

        <a class="method-permalink" href="#unless_defined%3F%28const%2C%26code%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>This macro accepts a constant, or a string or a symbol of a fully qualified constant name.
It validates whether the constant is defined, starting at the top level. If the
constant is not defined, the code passed to the macro via a block will be instantiated.
This permits conditional code evaluation based on whether a constant is defined.</p>
<pre><code class="language-crystal">unless_defined?(<span class="s">&quot;SpecialLibrary&quot;</span>) <span class="k">do</span>
  <span class="t">Workaround</span>.configure
<span class="k">end</span></code></pre>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="unless_disabled?(env_var,&amp;block)-macro">
      <div class="signature">
        
        macro <strong>unless_disabled?</strong>(env_var, &block)

        <a class="method-permalink" href="#unless_disabled%3F%28env_var%2C%26block%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment
variable is set.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="unless_enabled?(env_var,&amp;block)-macro">
      <div class="signature">
        
        macro <strong>unless_enabled?</strong>(env_var, &block)

        <a class="method-permalink" href="#unless_enabled%3F%28env_var%2C%26block%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>Instantiate the code that is passed in the block only if the <code>env_var</code> environment
variable is not set.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  
    <div class="entry-detail" id="unless_version?(const,comparison,value,&amp;code)-macro">
      <div class="signature">
        
        macro <strong>unless_version?</strong>(const, comparison, value, &code)

        <a class="method-permalink" href="#unless_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">#</a>
      </div>
      
        <div class="doc">
          
          <p>See the documentation for <code><a href="toplevel.html#if_version%3F%28const%2Ccomparison%2Cvalue%2C%26code%29-macro">#if_version?</a></code>.</p>
        </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  


</div>

</body>
</html>
